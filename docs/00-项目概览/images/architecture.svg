<svg width="1400" height="950" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Gradients -->
    <linearGradient id="clientGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gatewayGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="serviceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="infraGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="observabilityGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
    </linearGradient>

    <!-- Drop Shadow Filter -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000" flood-opacity="0.15"/>
    </filter>

    <!-- Arrow Markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
    <marker id="arrowhead-pink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fa709a"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#419eda"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="950" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="700" y="35" font-family="Arial, sans-serif" font-size="26" font-weight="bold" text-anchor="middle" fill="#333">CloudWeGo 微服务架构图</text>
  <text x="700" y="60" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#666">星型拓扑 | Kitex + Hertz + PostgreSQL + Redis + etcd + RustFS + OpenTelemetry</text>

  <!-- Architecture Principle Box -->
  <g transform="translate(1100, 85)">
    <rect x="0" y="0" width="280" height="100" rx="8" fill="white" stroke="#667eea" stroke-width="2" filter="url(#shadow)"/>
    <text x="140" y="22" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#667eea">架构原则</text>
    <text x="15" y="42" font-family="Arial, sans-serif" font-size="10" fill="#555">1. 星型拓扑: 网关为中心</text>
    <text x="15" y="58" font-family="Arial, sans-serif" font-size="10" fill="#555">2. 安全分层: 鉴权在网关层</text>
    <text x="15" y="74" font-family="Arial, sans-serif" font-size="10" fill="#555">3. RPC服务不互相调用</text>
    <text x="15" y="90" font-family="Arial, sans-serif" font-size="10" fill="#555">4. 无状态设计: 支持水平扩展</text>
  </g>

  <!-- Layer Labels -->
  <text x="30" y="115" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#555">客户端层</text>
  <text x="30" y="235" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#555">API网关层</text>
  <text x="30" y="445" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#555">RPC服务层</text>
  <text x="30" y="655" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#555">基础设施层</text>

  <!-- Layer Dividers -->
  <line x1="20" y1="170" x2="1080" y2="170" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="20" y1="380" x2="1080" y2="380" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="20" y1="590" x2="1080" y2="590" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- ========== CLIENT LAYER ========== -->
  <g transform="translate(350, 90)">
    <rect x="0" y="0" width="400" height="60" rx="10" fill="url(#clientGradient)" filter="url(#shadow)"/>
    <text x="200" y="25" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="white">客户端</text>
    <text x="200" y="45" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="rgba(255,255,255,0.9)">Web / Mobile / API Client (HTTP/JSON)</text>
  </g>

  <!-- ========== GATEWAY LAYER ========== -->
  <g transform="translate(100, 190)">
    <rect x="0" y="0" width="900" height="170" rx="10" fill="white" stroke="#f5576c" stroke-width="2" filter="url(#shadow)"/>
    <text x="450" y="25" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#333">API 网关 (Gateway)</text>
    <text x="450" y="42" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">Hertz Framework | Port 8080</text>

    <!-- Middleware Chain -->
    <text x="30" y="65" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e91e63">中间件链:</text>

    <g transform="translate(30, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">CORS</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">跨域处理</text>
    </g>
    <g transform="translate(120, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">Trace</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">链路追踪</text>
    </g>
    <g transform="translate(210, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">AccessLog</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">访问日志</text>
    </g>
    <g transform="translate(300, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">JWT</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">认证中间件</text>
    </g>
    <g transform="translate(390, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">Casbin</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">RBAC授权</text>
    </g>
    <g transform="translate(480, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">Error</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">错误处理</text>
    </g>
    <g transform="translate(570, 75)">
      <rect x="0" y="0" width="80" height="40" rx="5" fill="url(#gatewayGradient)"/>
      <text x="40" y="18" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">Response</text>
      <text x="40" y="32" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">统一响应</text>
    </g>

    <!-- Gateway Layers -->
    <text x="30" y="135" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#e91e63">分层架构:</text>

    <g transform="translate(130, 125)">
      <rect x="0" y="0" width="170" height="32" rx="4" fill="#fff0f5" stroke="#f5576c" stroke-width="1"/>
      <text x="85" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#e91e63">Handler</text>
      <text x="85" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">biz/handler</text>
    </g>
    <g transform="translate(320, 125)">
      <rect x="0" y="0" width="170" height="32" rx="4" fill="#fff0f5" stroke="#f5576c" stroke-width="1"/>
      <text x="85" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#e91e63">Domain Service</text>
      <text x="85" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">internal/domain</text>
    </g>
    <g transform="translate(510, 125)">
      <rect x="0" y="0" width="170" height="32" rx="4" fill="#fff0f5" stroke="#f5576c" stroke-width="1"/>
      <text x="85" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#e91e63">Assembler</text>
      <text x="85" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">HTTP ↔ RPC DTO</text>
    </g>
    <g transform="translate(700, 125)">
      <rect x="0" y="0" width="170" height="32" rx="4" fill="#fff0f5" stroke="#f5576c" stroke-width="1"/>
      <text x="85" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#e91e63">RPC Client</text>
      <text x="85" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">infrastructure/client</text>
    </g>
  </g>

  <!-- ========== RPC SERVICE LAYER ========== -->
  <g transform="translate(100, 400)">
    <rect x="0" y="0" width="900" height="170" rx="10" fill="white" stroke="#00f2fe" stroke-width="2" filter="url(#shadow)"/>
    <text x="450" y="25" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#333">身份认证服务 (identity_srv)</text>
    <text x="450" y="42" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">Kitex RPC Framework | Port 8891 | Thrift Protocol</text>

    <!-- Service Modules -->
    <text x="30" y="65" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#00a8cc">业务模块:</text>

    <g transform="translate(30, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">用户管理</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">user</text>
    </g>
    <g transform="translate(130, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">组织管理</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">organization</text>
    </g>
    <g transform="translate(230, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">部门管理</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">department</text>
    </g>
    <g transform="translate(330, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">成员关系</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">membership</text>
    </g>
    <g transform="translate(430, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">角色定义</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">definition</text>
    </g>
    <g transform="translate(530, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">角色分配</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">assignment</text>
    </g>
    <g transform="translate(630, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">菜单管理</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">menu</text>
    </g>
    <g transform="translate(730, 75)">
      <rect x="0" y="0" width="90" height="35" rx="4" fill="url(#serviceGradient)"/>
      <text x="45" y="15" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">Logo管理</text>
      <text x="45" y="28" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">logo</text>
    </g>

    <!-- Service Layers -->
    <text x="30" y="130" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#00a8cc">分层架构:</text>

    <g transform="translate(130, 120)">
      <rect x="0" y="0" width="130" height="32" rx="4" fill="#e0f7fa" stroke="#00bcd4" stroke-width="1"/>
      <text x="65" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#00838f">Handler</text>
      <text x="65" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">RPC适配层</text>
    </g>
    <g transform="translate(280, 120)">
      <rect x="0" y="0" width="130" height="32" rx="4" fill="#e0f7fa" stroke="#00bcd4" stroke-width="1"/>
      <text x="65" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#00838f">Logic</text>
      <text x="65" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">业务逻辑层</text>
    </g>
    <g transform="translate(430, 120)">
      <rect x="0" y="0" width="130" height="32" rx="4" fill="#e0f7fa" stroke="#00bcd4" stroke-width="1"/>
      <text x="65" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#00838f">DAL</text>
      <text x="65" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">数据访问层</text>
    </g>
    <g transform="translate(580, 120)">
      <rect x="0" y="0" width="130" height="32" rx="4" fill="#e0f7fa" stroke="#00bcd4" stroke-width="1"/>
      <text x="65" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#00838f">Converter</text>
      <text x="65" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">DTO↔Model转换</text>
    </g>
    <g transform="translate(730, 120)">
      <rect x="0" y="0" width="130" height="32" rx="4" fill="#e0f7fa" stroke="#00bcd4" stroke-width="1"/>
      <text x="65" y="14" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#00838f">Models</text>
      <text x="65" y="26" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">GORM模型</text>
    </g>
  </g>

  <!-- ========== INFRASTRUCTURE LAYER ========== -->
  <g transform="translate(50, 610)">
    <rect x="0" y="0" width="1000" height="150" rx="10" fill="white" stroke="#38f9d7" stroke-width="2" filter="url(#shadow)"/>
    <text x="500" y="25" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#333">基础设施层</text>
    <text x="500" y="42" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">Docker Compose 统一管理 | deploy.sh 一键部署</text>

    <!-- PostgreSQL -->
    <g transform="translate(25, 55)">
      <rect x="0" y="0" width="175" height="80" rx="8" fill="url(#infraGradient)"/>
      <text x="87" y="20" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">PostgreSQL 17</text>
      <text x="87" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">主数据库 :5432</text>
      <text x="87" y="55" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">GORM ORM + UUID</text>
      <text x="87" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">无FK约束(应用层验证)</text>
    </g>

    <!-- Redis -->
    <g transform="translate(220, 55)">
      <rect x="0" y="0" width="175" height="80" rx="8" fill="#dc382d"/>
      <text x="87" y="20" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Redis 8.4</text>
      <text x="87" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">缓存数据库 :6379</text>
      <text x="87" y="55" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">JWT黑名单</text>
      <text x="87" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">会话缓存 + AOF持久化</text>
    </g>

    <!-- etcd -->
    <g transform="translate(415, 55)">
      <rect x="0" y="0" width="175" height="80" rx="8" fill="#419eda"/>
      <text x="87" y="20" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">etcd</text>
      <text x="87" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">服务注册发现 :2379</text>
      <text x="87" y="55" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">RPC服务注册</text>
      <text x="87" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">网关动态发现</text>
    </g>

    <!-- RustFS -->
    <g transform="translate(610, 55)">
      <rect x="0" y="0" width="175" height="80" rx="8" fill="#c73a35"/>
      <text x="87" y="20" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">RustFS (S3)</text>
      <text x="87" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">对象存储 :9000</text>
      <text x="87" y="55" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">组织Logo存储</text>
      <text x="87" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">预签名URL + 双端点</text>
    </g>

    <!-- Jaeger -->
    <g transform="translate(805, 55)">
      <rect x="0" y="0" width="175" height="80" rx="8" fill="#60d0e4"/>
      <text x="87" y="20" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Jaeger</text>
      <text x="87" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">链路追踪 :16686</text>
      <text x="87" y="55" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">OTLP gRPC :4317</text>
      <text x="87" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">分布式追踪可视化</text>
    </g>
  </g>

  <!-- ========== OBSERVABILITY SIDEBAR ========== -->
  <g transform="translate(1100, 200)">
    <rect x="0" y="0" width="280" height="360" rx="10" fill="white" stroke="#fee140" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="280" height="35" rx="10" fill="url(#observabilityGradient)"/>
    <text x="140" y="24" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">可观测性</text>

    <g transform="translate(20, 50)">
      <rect x="0" y="0" width="240" height="55" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="1"/>
      <text x="120" y="20" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#e65100">OpenTelemetry</text>
      <text x="120" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">统一采集 Trace + Metrics</text>
    </g>

    <g transform="translate(20, 115)">
      <rect x="0" y="0" width="240" height="55" rx="5" fill="#e3f2fd" stroke="#2196f3" stroke-width="1"/>
      <text x="120" y="20" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#1565c0">Zerolog</text>
      <text x="120" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">高性能结构化日志</text>
    </g>

    <g transform="translate(20, 180)">
      <rect x="0" y="0" width="240" height="55" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
      <text x="120" y="20" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2e7d32">Google Wire</text>
      <text x="120" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">编译时依赖注入</text>
    </g>

    <g transform="translate(20, 245)">
      <rect x="0" y="0" width="240" height="55" rx="5" fill="#fce4ec" stroke="#e91e63" stroke-width="1"/>
      <text x="120" y="20" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#c2185b">Error Handling</text>
      <text x="120" y="38" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">errno → BizStatusError</text>
    </g>

    <g transform="translate(20, 310)">
      <rect x="0" y="0" width="240" height="40" rx="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1"/>
      <text x="120" y="25" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">TTHeader 元数据传递</text>
    </g>
  </g>

  <!-- ========== ARROWS ========== -->
  <!-- Client to Gateway -->
  <path d="M 550 150 L 550 180" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <text x="560" y="168" font-family="Arial, sans-serif" font-size="9" fill="#555">HTTP</text>

  <!-- Gateway to RPC Service -->
  <path d="M 550 360 L 550 390" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <text x="560" y="378" font-family="Arial, sans-serif" font-size="9" fill="#555">RPC</text>

  <!-- RPC Service to PostgreSQL -->
  <path d="M 200 570 L 200 600" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>

  <!-- RPC Service to Redis -->
  <path d="M 360 570 L 360 600" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>

  <!-- RPC Service to RustFS -->
  <path d="M 750 570 L 750 600" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>

  <!-- Gateway to etcd (服务发现) -->
  <path d="M 1000 280 L 1040 280 L 1040 685 L 590 685 L 590 670" stroke="#419eda" stroke-width="2" stroke-dasharray="5,3" fill="none"/>
  <text x="815" y="698" font-family="Arial, sans-serif" font-size="9" fill="#419eda">服务发现</text>

  <!-- RPC Service to etcd (服务注册) -->
  <path d="M 550 570 L 550 600" stroke="#419eda" stroke-width="2" marker-end="url(#arrowhead-blue)" fill="none"/>
  <text x="510" y="590" font-family="Arial, sans-serif" font-size="9" fill="#419eda">注册</text>

  <!-- Observability data flow -->
  <path d="M 1000 260 L 1090 260" stroke="#fa709a" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-pink)" fill="none"/>
  <path d="M 1000 485 L 1090 485" stroke="#fa709a" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead-pink)" fill="none"/>

  <!-- ========== LEGEND ========== -->
  <g transform="translate(50, 780)">
    <rect x="0" y="0" width="1330" height="150" rx="10" fill="white" stroke="#ddd" stroke-width="1"/>
    <text x="665" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">图例说明</text>

    <!-- Flow Types -->
    <g transform="translate(30, 45)">
      <line x1="0" y1="0" x2="40" y2="0" stroke="#555" stroke-width="2" marker-end="url(#arrowhead)"/>
      <text x="50" y="5" font-family="Arial, sans-serif" font-size="10" fill="#555">同步调用</text>
    </g>
    <g transform="translate(30, 70)">
      <line x1="0" y1="0" x2="40" y2="0" stroke="#419eda" stroke-width="2" stroke-dasharray="5,3"/>
      <text x="50" y="5" font-family="Arial, sans-serif" font-size="10" fill="#555">服务注册/发现</text>
    </g>
    <g transform="translate(30, 95)">
      <line x1="0" y1="0" x2="40" y2="0" stroke="#fa709a" stroke-width="2" stroke-dasharray="5,3"/>
      <text x="50" y="5" font-family="Arial, sans-serif" font-size="10" fill="#555">可观测性数据流</text>
    </g>

    <!-- Key Features -->
    <g transform="translate(200, 45)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">技术栈:</text>
      <text x="0" y="18" font-family="Arial, sans-serif" font-size="10" fill="#555">Hertz (HTTP) + Kitex (RPC) + Thrift (IDL)</text>
      <text x="0" y="36" font-family="Arial, sans-serif" font-size="10" fill="#555">PostgreSQL + Redis + etcd + RustFS</text>
      <text x="0" y="54" font-family="Arial, sans-serif" font-size="10" fill="#555">OpenTelemetry + Jaeger + Zerolog</text>
    </g>

    <g transform="translate(500, 45)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">开发模式:</text>
      <text x="0" y="18" font-family="Arial, sans-serif" font-size="10" fill="#555">IDL-First: Thrift 定义接口，代码生成</text>
      <text x="0" y="36" font-family="Arial, sans-serif" font-size="10" fill="#555">Go Workspace: 多模块统一管理</text>
      <text x="0" y="54" font-family="Arial, sans-serif" font-size="10" fill="#555">Wire DI: 编译时依赖注入</text>
    </g>

    <g transform="translate(800, 45)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">错误处理:</text>
      <text x="0" y="18" font-family="Arial, sans-serif" font-size="10" fill="#555">DAL: GORM错误 → ErrNo (6位错误码)</text>
      <text x="0" y="36" font-family="Arial, sans-serif" font-size="10" fill="#555">Handler: errno.ToKitexError()</text>
      <text x="0" y="54" font-family="Arial, sans-serif" font-size="10" fill="#555">Client: kerrors.FromBizStatusError()</text>
    </g>

    <g transform="translate(1080, 45)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#333">部署命令:</text>
      <text x="0" y="18" font-family="Consolas, monospace" font-size="9" fill="#555">./deploy.sh up</text>
      <text x="0" y="36" font-family="Consolas, monospace" font-size="9" fill="#555">sh build.sh</text>
      <text x="0" y="54" font-family="Consolas, monospace" font-size="9" fill="#555">sh output/bootstrap.sh</text>
    </g>
  </g>

  <!-- Footer -->
  <text x="1350" y="940" font-family="Arial, sans-serif" font-size="10" text-anchor="end" fill="#999">CloudWeGo Microservice Demo - System Architecture</text>
</svg>
