# RBAC with Domains + Role Inheritance + Data Scope
# 五维权限模型: 用户-角色-权限-科室-数据范围

[request_definition]
# 请求定义: 主体, 域(科室), 资源对象, 操作
r = sub, dom, obj, act

[policy_definition]
# 策略定义: 主体(角色编码), 域(科室ID), 资源对象, 操作, 数据范围
p = sub, dom, obj, act, data_scope

[role_definition]
# g: 用户-角色-科室 绑定 (用户在特定科室拥有特定角色)
g = _, _, _
# g2: 角色继承 (父子角色关系)
g2 = _, _

[policy_effect]
# 任何一条策略允许即允许
e = some(where (p.eft == allow))

[matchers]
# 匹配器:
# 1. 用户在指定域(科室)拥有对应角色
# 2. 域匹配 (支持 * 通配符表示全院)
# 3. 资源对象匹配
# 4. 操作匹配
# 5. 支持角色继承 (g2)
m = (g(r.sub, p.sub, r.dom) || g(r.sub, p.sub, "*")) && \
    (r.dom == p.dom || p.dom == "*") && \
    keyMatch2(r.obj, p.obj) && \
    (r.act == p.act || p.act == "*")
