# 前端开发规范

## 数据类型约定

### 时间戳格式

**规则**：后端返回的所有时间字段均为**毫秒级时间戳**（13位整数，Unix timestamp in milliseconds）。

#### 定义

- **类型**：`number`（非字符串）
- **单位**：毫秒（milliseconds）
- **示例**：`1766021112386`（对应 2025-01-01 某时刻）

#### Swagger 定义示例

```json
{
  "created_at": {
    "description": "* 创建时间",
    "type": "integer",
    "format": "int64"
  },
  "updated_at": {
    "description": "* 更新时间",
    "type": "integer",
    "format": "int64"
  }
}
```

#### API 响应示例

```json
{
  "user_profile": {
    "id": "e91b4a72-6c22-415e-80a9-f268a128f227",
    "username": "superadmin",
    "created_at": 1766021112386,
    "updated_at": 1771919315301,
    "last_login_time": 1771919315300
  }
}
```

---

## 前端处理规范

### 1. 类型定义

在 TypeScript 中，时间戳字段应定义为 `number` 类型：

```typescript
// ✅ 正确
interface UserProfile {
  id: string
  username: string
  created_at: number  // 毫秒时间戳
  updated_at?: number  // 可选
}

// ❌ 错误
interface UserProfile {
  created_at: string  // 不要用字符串
  created_at: Date    // 不要用 Date 对象
}
```

### 2. 时间转换工具函数

在 `web/src/utils/date.ts` 中提供时间转换工具：

```typescript
/**
 * 将毫秒时间戳转换为 Date 对象
 */
export function timestampToDate(timestamp: number): Date {
  return new Date(timestamp)
}

/**
 * 格式化时间戳为本地时间字符串
 * @param timestamp 毫秒时间戳
 * @param format 格式模板（可选），默认 'YYYY-MM-DD HH:mm:ss'
 */
export function formatTimestamp(
  timestamp: number,
  format: string = 'YYYY-MM-DD HH:mm:ss'
): string {
  const date = new Date(timestamp)

  const year = date.getFullYear()
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const day = String(date.getDate()).padStart(2, '0')
  const hours = String(date.getHours()).padStart(2, '0')
  const minutes = String(date.getMinutes()).padStart(2, '0')
  const seconds = String(date.getSeconds()).padStart(2, '0')

  return format
    .replace('YYYY', String(year))
    .replace('MM', month)
    .replace('DD', day)
    .replace('HH', hours)
    .replace('mm', minutes)
    .replace('ss', seconds)
}

/**
 * 格式化为相对时间（如"3分钟前"）
 */
export function formatRelativeTime(timestamp: number): string {
  const now = Date.now()
  const diff = now - timestamp

  const seconds = Math.floor(diff / 1000)
  const minutes = Math.floor(seconds / 60)
  const hours = Math.floor(minutes / 60)
  const days = Math.floor(hours / 24)

  if (seconds < 60) return '刚刚'
  if (minutes < 60) return `${minutes}分钟前`
  if (hours < 24) return `${hours}小时前`
  if (days < 7) return `${days}天前`

  return formatTimestamp(timestamp, 'YYYY-MM-DD')
}

/**
 * 检查时间戳是否过期
 */
export function isTimestampExpired(timestamp: number, maxAge: number): boolean {
  const now = Date.now()
  return now - timestamp > maxAge
}
```

### 3. 在组件中使用

```vue
<template>
  <div>
    <p>创建时间: {{ formatDate(user.created_at) }}</p>
    <p>相对时间: {{ formatRelativeTime(user.created_at) }}</p>
  </div>
</template>

<script setup lang="ts">
import { formatTimestamp, formatRelativeTime } from '@/utils/date'

const user = {
  id: 'xxx',
  username: 'superadmin',
  created_at: 1766021112386  // 后端返回的毫秒时间戳
}

function formatDate(timestamp: number) {
  return formatTimestamp(timestamp)
}
</script>
```

### 4. Day.js 选项（推荐）

安装 Day.js：

```bash
npm install dayjs
```

配置扩展：

```typescript
// web/src/utils/dayjs.ts
import dayjs from 'dayjs'
import relativeTime from 'dayjs/plugin/relativeTime'
import 'dayjs/locale/zh-cn'

dayjs.extend(relativeTime)
dayjs.locale('zh-cn')

/**
 * 将毫秒时间戳转换为 Day.js 对象
 */
export function toDayjs(timestamp: number) {
  return dayjs(timestamp)
}

/**
 * 格式化时间戳
 */
export function formatTimestamp(timestamp: number, format = 'YYYY-MM-DD HH:mm:ss') {
  return dayjs(timestamp).format(format)
}

/**
 * 格式化为相对时间
 */
export function formatRelativeTime(timestamp: number) {
  return dayjs(timestamp).fromNow()
}
```

使用：

```vue
<script setup lang="ts">
import { formatTimestamp, formatRelativeTime } from '@/utils/dayjs'

const createdTime = formatTimestamp(1766021112386)  // '2025-01-01 12:00:00'
const relativeTime = formatRelativeTime(1766021112386)  // '3个月前'
</script>
```

---

## 常见字段

以下是常见的时间戳字段：

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `created_at` | `number` | 创建时间 | `1766021112386` |
| `updated_at` | `number` | 更新时间 | `1771919315301` |
| `deleted_at` | `number` | 删除时间（软删除） | `1772000000000` |
| `last_login_time` | `number` | 最后登录时间 | `1771919315300` |
| `account_expiry` | `number` | 账户过期时间 | `1772000000000` |
| `expires_in` | `number` | 过期时长（秒） | `1799` |

**注意**：`expires_in` 是**秒数**，不是时间戳！

---

## 注意事项

### ❌ 不要做的事

1. **不要将时间戳转换为字符串存储**
   ```typescript
   // ❌ 错误
   interface User {
     created_at: string  // "1766021112386"
   }
   ```

2. **不要在前端使用 Date 对象存储**
   ```typescript
   // ❌ 错误
   interface User {
     created_at: Date  // 失去原始精度
   }
   ```

3. **不要假设时间戳单位**
   ```typescript
   // ❌ 错误（假设是秒）
   const date = new Date(timestamp * 1000)

   // ✅ 正确（直接使用毫秒时间戳）
   const date = new Date(timestamp)
   ```

### ✅ 推荐做法

1. **保持原始时间戳**
   ```typescript
   // ✅ 正确
   interface User {
     created_at: number  // 保持原始值
   }
   ```

2. **使用工具函数转换**
   ```typescript
   // ✅ 正确
   const displayTime = formatTimestamp(user.created_at)
   ```

3. **处理可选字段**
   ```typescript
   // ✅ 正确
   interface User {
     created_at: number
     updated_at?: number  // 可选字段
   }

   function formatTime(timestamp: number | undefined): string {
     if (!timestamp) return '-'
     return formatTimestamp(timestamp)
   }
   ```

---

## 相关资源

- [Unix Timestamp - Wikipedia](https://en.wikipedia.org/wiki/Unix_time)
- [JavaScript Date - MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)
- [Day.js 文档](https://day.js.org/)

---

**版本**：v1.0
**最后更新**：2026-02-24
**维护者**：前端团队
